# gx Design Document

## Overview

`gx` is a TypeScript/Bun CLI tool that combines git repository cloning with project navigation. It replaces `gclone` (Go) and the `proj` zsh plugin with a single tool.

## Architecture

Two components:

1. **`gx` binary** — TypeScript compiled via `bun build --compile`. Handles cloning, URL parsing, index management, and config.
2. **`gx` zsh plugin** — Thin oh-my-zsh plugin (~30 lines). Wraps binary for `cd` and tab completion.

The binary outputs paths to stdout. The plugin calls the binary and performs the actual `cd`.

## CLI Interface

```
gx <name>                # Jump to project (default action)
gx clone <repo>          # Clone, index, and cd into it
gx ls                    # List all indexed projects
gx rebuild               # Rescan projectDir and rebuild index
gx config                # Show current config
gx config set <key> <v>  # Set config value
gx resolve <name>        # Internal: resolve name to path (for plugin)
gx resolve --list        # Internal: list all names (for completion)
gx --help                # Help
gx --version             # Version
```

## URL Formats

Supports 4 formats (ported from gclone):

| Format | Example |
|--------|---------|
| Shorthand | `user/repo` (expands to github.com) |
| HTTPS | `https://github.com/user/repo.git` |
| SSH | `git@github.com:user/repo.git` |
| Git protocol | `git://github.com/user/repo.git` |

## Directory Structure

Configurable via `structure` setting:

- `flat` (default): `~/Projects/src/user/repo`
- `host`: `~/Projects/src/github.com/user/repo`

## Config (`~/.config/gx/config.json`)

```json
{
  "projectDir": "~/Projects/src",
  "defaultHost": "github.com",
  "structure": "flat",
  "shallow": false
}
```

## Index (`~/.config/gx/index.json`)

```json
{
  "projects": {
    "gx": {
      "path": "/home/user/Projects/src/joshuaboys/gx",
      "url": "https://github.com/joshuaboys/gx",
      "clonedAt": "2026-02-22T00:00:00Z"
    }
  }
}
```

## Project Structure

```
gx/
├── src/
│   ├── index.ts          # CLI entry point
│   ├── commands/
│   │   ├── clone.ts
│   │   ├── ls.ts
│   │   ├── resolve.ts
│   │   ├── rebuild.ts
│   │   └── config.ts
│   ├── lib/
│   │   ├── config.ts
│   │   ├── index.ts
│   │   ├── url.ts
│   │   └── path.ts
│   └── types.ts
├── plugin/
│   └── gx.plugin.zsh
├── tests/
│   └── ...
├── package.json
├── tsconfig.json
└── plans/
```

## Decisions

- **D-001:** Flat directory structure by default, host mode via config
- **D-002:** github.com as default host for shorthand
- **D-003:** Binary + zsh plugin architecture
- **D-004:** `gx <name>` as default action (jump to project)
