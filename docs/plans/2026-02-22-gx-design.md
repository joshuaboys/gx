# gx Design Document

## Overview

`gx` is a TypeScript/Bun CLI tool that combines git repository cloning with project navigation. It replaces `gclone` (Go) and the `proj` zsh plugin with a single tool.

## Architecture

Two components:

1. **`gx` binary** — TypeScript compiled via `bun build --compile`. Handles cloning, URL parsing, index management, and config.
2. **`gx` zsh plugin** — Thin oh-my-zsh plugin (~30 lines). Wraps binary for `cd` and tab completion.

The binary outputs paths to stdout. The plugin calls the binary and performs the actual `cd`.

## CLI Interface

```
gx <name>                # Jump to project (default action)
gx clone <repo>          # Clone, index, and cd into it
gx ls                    # List all indexed projects
gx rebuild               # Rescan projectDir and rebuild index
gx config                # Show current config
gx config set <key> <v>  # Set config value
gx open [name]           # Open project in preferred editor
gx init                  # Scaffold .claude/ agent config for project
gx shell-init [shell]    # Print shell integration code (zsh/bash/fish)
gx resolve <name>        # Internal: resolve name to path (for plugin)
gx resolve --list        # Internal: list all names (for completion)
gx --help                # Help
gx --version             # Version
```

## URL Formats

Supports 4 formats (ported from gclone):

| Format | Example |
|--------|---------|
| Shorthand | `user/repo` (expands to github.com) |
| HTTPS | `https://github.com/user/repo.git` |
| SSH | `git@github.com:user/repo.git` |
| Git protocol | `git://github.com/user/repo.git` |

## Directory Structure

Configurable via `structure` setting:

- `owner` (default): `~/Projects/src/user/repo`
- `flat`: `~/Projects/src/repo`
- `host`: `~/Projects/src/github.com/user/repo`

## Config (`~/.config/gx/config.json`)

```json
{
  "projectDir": "~/Projects/src",
  "defaultHost": "github.com",
  "structure": "owner",
  "shallow": false,
  "similarityThreshold": 0.7,
  "editor": ""
}
```

## Index (`~/.config/gx/index.json`)

```json
{
  "projects": {
    "gx": {
      "path": "/home/user/Projects/src/joshuaboys/gx",
      "url": "https://github.com/joshuaboys/gx",
      "clonedAt": "2026-02-22T00:00:00Z"
    }
  }
}
```

## Project Structure

```
gx/
├── src/
│   ├── index.ts          # CLI entry point
│   ├── commands/
│   │   ├── clone.ts
│   │   ├── config.ts
│   │   ├── init.ts       # .claude/ scaffolding (v2)
│   │   ├── ls.ts
│   │   ├── open.ts       # editor integration (v2)
│   │   ├── rebuild.ts
│   │   ├── resolve.ts
│   │   └── shell-init.ts # shell integration generator (v2)
│   ├── lib/
│   │   ├── config.ts
│   │   ├── detect.ts     # project type detection (v2)
│   │   ├── fuzzy.ts      # Jaro-Winkler matching (v2)
│   │   ├── index.ts      # ProjectIndex class
│   │   ├── path.ts
│   │   ├── templates.ts  # .claude/ templates (v2)
│   │   └── url.ts
│   └── types.ts
├── plugin/
│   └── gx.plugin.zsh     # oh-my-zsh compatibility shim
├── tests/
│   └── ...
├── install.sh            # curl installer
├── package.json
├── tsconfig.json
└── plans/
```

## Decisions

- **D-001:** Owner/repo directory structure by default (`owner`), host and flat modes via config
- **D-002:** github.com as default host for shorthand
- **D-003:** Binary + shell integration architecture (`gx shell-init` generates eval-able code for zsh/bash/fish)
- **D-004:** `gx <name>` as default action (jump to project)
